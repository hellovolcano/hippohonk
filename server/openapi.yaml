openapi: 3.1.0
info:
  title: Hippohonk API
  version: 0.1.0
  description: > 
    An API used for reading from and adding to the list of music festival-related 
    information in the Hippohonk database.

    You can retrieve various information about bands and festivals.

servers:
  - url: https://hippohonk-api-642586320677.herokuapp.com/
    description: Local dev

tags:
  - name: Bands
  - name: Genres
  - name: Festivals
  - name: Lineups
  - name: Users

paths:
  /bands:
    get:
      tags: [Bands]
      summary: Get all bands in the database.
      description: |
        Returns a list of bands ordered by average rating (descending).

        Optional filters:
        - `genre_id`: only return bands in the specified genre
        - `min_rating`: only return bands with `average_rating >= min_rating`
        - `location`: only return bands matching the specified location
      parameters:
        - name: genre_id
          in: query
          required: false
          description: Filter results to bands in the specified genre.
          schema:
            type: integer
          example: 2

      x-codeSamples:
        - lang: curl
          source: |
            # All bands
            curl /bands

            # Filter by genre_id
            curl "/bands?genre_id=2"
        - lang: python
          source: |
            import requests

            url = "/bands"

            # All bands
            response = requests.get(url)
            print(response.status_code)
            print(response.json())

            # Filter by genre_id
            params = {"genre_id": 2}
            response = requests.get(url, params=params)
            print(response.status_code)
            print(response.json())

      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/BandListItem"
              examples:
                default:
                  summary: List of bands
                  value:
                    - band_id: 1386
                      name: "Phantogram"
                      description: "Dark ambient indie electro-pop who have been at the forefront of this genre for a decade."
                      average_rating: 4.89
                      location: "Saratoga Springs, NY"
                      url: "http://phantogrammusic.virb.com/music"
                      genre_id: 45
                      genre_name: "Synth Pop"
                      image: "v1425489534/raqs1rix20wrl4smrg4i.png"
                    - band_id: 1608
                      name: "Kishi Bashi"
                      description: "A classically trained violinist, Kishi Bashi (the pseudonym of Kaoru Ishibashi) makes highly catchy indie pop tracks using repeated loops of instrumentation and vocals. Unique and mesmerizing live."
                      average_rating: 5.0
                      location: "Athensa GA"
                      url: "http://www.kishibashi.com/music"
                      genre_id: 44
                      genre_name: "Indie Pop"
                      image: "v1425262448/yzo3mysaolekvammwh00.png"

        "400":
          description: Invalid query parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidGenreId:
                  summary: genre_id is not a number
                  value:
                    error: "Invalid query parameter"
                    message: "genre_id must be a number"
        "500":
          $ref: "#/components/responses/ServerError"

    post:
      tags: [Bands]
      summary: Create a new band
      description: |
        Creates a new band in the hippohonk database.

        Required params: `name`, `genre_id`

        **Note:** Genres are managed as a standardized list to support filtering by genre. 
        Refer to the [Genres API documentation](/docs/api/genres) to get a list of genres.
      x-codeSamples:
        - lang: curl
          source: |
            curl -X POST /bands \
              -H "Content-Type: application/json" \
              -d '{
                "name": "Jungle",
                "genre_id": 2,
                "average_rating": 5
              }'
        - lang: python
          source: |
            import requests

            url = "/bands"
            payload = {
                "name": "Jungle",
                "genre_id": 2,
                "average_rating": 5
              }

            response = requests.post(url, json=payload)

            print(response.status_code)
            print(response.json())
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BandCreate"
            examples:
              basic:
                summary: Request with minimum required parameters
                value:
                  name: "Jungle"
                  genre_id: 2
              withRating:
                summary: Request with additional parameters
                value:
                  name: "The Last Dinner Party"
                  genre_id: 5
                  average_rating: 5
      responses:
        "201":
          description: Band creation successful.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Band"
        "500":
          $ref: "#/components/responses/ServerError"

  /bands/{id}:
    get:
      tags: [Bands]
      summary: Get band by id.
      description: Retrieves all information about a specific band.
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK (null if not found)
          content:
            application/json:
              schema:
                nullable: true
                oneOf:
                  - $ref: "#/components/schemas/BandDetail"
                  - type: "null"
        "500":
          $ref: "#/components/responses/ServerError"

  /genres:
    get:
      tags: [Genres]
      summary: List genres
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Genre"
        "500":
          $ref: "#/components/responses/ServerError"

    post:
      tags: [Genres]
      summary: Create a new genre
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenreCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Genre"
        "500":
          $ref: "#/components/responses/ServerError"

  /festivals:
    get:
      tags: [Festivals]
      summary: List festivals
      description: Returns a list of festivals sorted by most recent.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Festival"
        "500":
          $ref: "#/components/responses/ServerError"

  /festivals/{slug}:
    get:
      tags: [Festivals]
      summary: Get festival by slug
      description: Returns the festival at the user-specified pretty path.
      parameters:
        - $ref: "#/components/parameters/SlugPathParam"
      responses:
        "200":
          description: OK (null if not found)
          content:
            application/json:
              schema:
                nullable: true
                oneOf:
                  - $ref: "#/components/schemas/Festival"
                  - type: "null"
        "500":
          $ref: "#/components/responses/ServerError"

  /users:
    get:
      tags: [Users]
      summary: List users
      description: List all users who have contributed Hippohonk reviews and their various access levels.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "500":
          $ref: "#/components/responses/ServerError"

  /lineups:
    get:
      tags: [Lineups]
      summary: List lineups
      description: |
        All lineups in the database. 
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LineupListItem"
        "500":
          $ref: "#/components/responses/ServerError"

    post:
      tags: [Lineups]
      summary: Add a band to a lineup.
      description: Currently hardcoded to SXSW 2023. The API will eventually be adapted to allow lineup configuration.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LineupCreate"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Lineup"
        "500":
          $ref: "#/components/responses/ServerError"

  /lineups/{id}:
    get:
      tags: [Lineups]
      summary: List bands in a lineup by festival id
      description: Uses `{id}` as the festival_id.
      parameters:
        - $ref: "#/components/parameters/IdPathParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/LineupByFestivalItem"
        "500":
          $ref: "#/components/responses/ServerError"

components:
  parameters:
    IdPathParam:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier for the object.

    SlugPathParam:
      name: slug
      in: path
      required: true
      schema:
        type: string
      description: Short name to use as the browser path.
      example: sxsw-2025

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    ServerError:
      description: Server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
      required: [message]
      additionalProperties: true

    # ----------------
    # Shared Properties
    # ----------------

    name:
      type: string
      description: Name of the band.
      example: Faux Real
    description:
      type: text
      description: Summary of the band that can't be captured through genre alone.
      example: >
        French Art Pop duo producing jams with an eye for performance. We are all living in the 
        United Snakes of America, and the brothers Arndt are the snake charmers.
    average_rating:
      type: number
      description: Average rating for the band.
      example: 4
    location:
      type: string
      description: Location the band calls home.
      example: Los Angeles, CA
    url: 
      type: string
      nullable: true
      description: URL for the band's website or social media site.
      example: https://isthisfauxreal.com/
    genre_id:
      type: integer
      nullable: true
      description: Unique ID for a genre.
      example: 2
    genre_name:
      type: string
      nullable: true
      description: Name for a band's primary genre.
      example: Art Pop
    image: 
      type: string
      nullable: true
      description: > 
        Path to the web-hosted image. This image should be pre-processed to the correct size 
        and hosted in a secure location.
      example: Currently not implemented

    # ----------------
    # Bands
    # ----------------
    BandListItem:
      type: object
      additionalProperties: false
      properties:
        band_id: 
          type: integer
          description: Unique ID for the band.
        name: 
          $ref: '#/components/schemas/name'
        description: 
          $ref: '#/components/schemas/description'
        average_rating:
          $ref: '#/components/schemas/average_rating'
        location: 
          $ref: '#/components/schemas/location'
        url: 
          $ref: '#/components/schemas/url'
        genre_id: 
          $ref: '#/components/schemas/genre_id'
        genre_name: 
          $ref: '#/components/schemas/genre_name'
        image:
          $ref: '#/components/schemas/image'

    BandDetail:
      type: object
      additionalProperties: false
      properties:
        id: 
          type: integer
          description: Unique ID for the band.
        name: 
          $ref: '#/components/schemas/name'
        description: 
          $ref: '#/components/schemas/description'
        average_rating:
          $ref: '#/components/schemas/average_rating'
        location: 
          $ref: '#/components/schemas/location'
        url: 
          $ref: '#/components/schemas/url'
        genre_id: 
          $ref: '#/components/schemas/genre_id'
        genre_name: 
          $ref: '#/components/schemas/genre_name'
        image: 
          $ref: '#/components/schemas/image'
      required: [id, name]

    BandCreate:
      type: object
      additionalProperties: false
      properties:
        name: 
          type: string
          description: Name of the band.
        description: 
          $ref: '#/components/schemas/description'
        average_rating:
          $ref: '#/components/schemas/average_rating'
        location: 
          $ref: '#/components/schemas/location'
        genre_id: 
          $ref: '#/components/schemas/genre_id'
      required: [name, genre_id]

    Band:
      type: object
      description: Sequelize Band model as returned by Band.create (fields may include timestamps depending on model).
      additionalProperties: true
      properties:
        id:
          type: integer
          description: Unique ID for the band.
        name: 
          $ref: '#/components/schemas/name'
        description: 
          $ref: '#/components/schemas/description'
        average_rating:
          $ref: '#/components/schemas/average_rating'
        location:
          $ref: '#/components/schemas/location'
        genre_id: 
          $ref: '#/components/schemas/genre_id'
        url: 
          $ref: '#/components/schemas/url'

    # ----------------
    # Genres
    # ----------------
    GenreCreate:
      type: object
      additionalProperties: false
      properties:
        name:
          $ref: "#/components/schemas/genre_name"
      required: [name]

    Genre:
      type: object
      description: Sequelize Genre model
      additionalProperties: true
      properties:
        id: 
          type: integer
          description: Unique ID for the genre. This is an auto-generated field.
        name: 
          $ref: '#/components/schemas/genre_name'

    # ----------------
    # Festivals
    # ----------------
    Festival:
      type: object
      description: Festival model.
      additionalProperties: true
      properties:
        id: { type: integer }
        name:
          type: string
          nullable: true
          description: Name of the festival
          example: SXSW 2025
        slug: 
          $ref: '#/components/parameters/SlugPathParam'
        date:
          type: string
          nullable: true
          description: Festival date.
          examples: ["2026-03-10"]

    # ----------------
    # Users
    # ----------------
    User:
      type: object
      description: Sequelize User model.
      additionalProperties: false
      properties:
        id: 
          type: integer
          description: Unique ID for the user.
        email: 
          type: string
          description: Email address associated with user.
        description:
          type: text
          description: Description for the user
        password_digest: 
          type: string
          description: User password for authentication.
        admin: 
          type: boolean
          description: Specifies if the user has access to administrative functions in the app.
        reviewer: 
          type: boolean
          description: Specifies if the user has access to the reviewer workflows in the app.


    # ----------------
    # Lineups
    # ----------------
    LineupCreate:
      type: object
      additionalProperties: false
      properties:
        band_id: 
          type: integer
          description: 
      required: [band_id]

    Lineup:
      type: object
      additionalProperties: false
      properties:
        id:
          type: integer
          description: Primary key.
        band_id:
          type: integer
          nullable: true
          description: FK to bands.id
        festival_id:
          type: integer
          nullable: true
          description: FK to festivals.id
        created_at:
          type: string
          format: date-time
          description: Timestamp when created.
        updated_at:
          type: string
          format: date-time
          description: Timestamp when last updated.
      required: [id, band_id, festival_id, created_at, updated_at]

    LineupListItem:
      type: object
      description: |
        Returns properties about a specific lineup
      additionalProperties: true
      properties:
        id: 
          type: integer
          description: Unique ID for the lineup.
        band_id: 
          type: integer
          description: Unique ID for the band.
        festival_id: 
          type: integer
          description: Unique ID for the festival.
        band:
          type: object
          nullable: true
          additionalProperties: true
          properties:
            id: 
              type: integer
              description: Unique ID for the band.
            name:
              $ref: '#/components/schemas/name'
        festival:
          type: object
          nullable: true
          additionalProperties: true
          properties:
            name: 
              type: string
              nullable: true
              description: Unique ID for the festival.
            date: 
              type: string
              nullable: true
              description: Festival date.

    LineupByFestivalItem:
      type: object
      additionalProperties: false
      properties:
        id: 
          type: integer
          description: Unique ID for festival-band pairing
        festival_id: 
          type: integer
          description: Unique ID of the festival.
        band_id: 
          type: integer
          description: Unique ID for the band.
        name: 
          $ref: '#/components/schemas/name'
        description: 
          $ref: '#/components/schemas/description'
        location:
          type: string
          nullable: true
          description: Location for the festival.
        average_rating: 
          $ref: '#/components/schemas/average_rating'
        image: 
          type: string
          nullable: true
          description: Image for the festival.
        festival_name: 
          type: string
          nullable: true
          description: Name of the festival.
      required: [id, festival_id, band_id]
